<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ç‚«é…·ç‰¹æ•ˆæ¼”ç¤º</title>
  <style>
    @import url('https://fonts.googleapis.com/css?family=Montserrat:700|Roboto:300&display=swap');
    html,body{height:100%;margin:0;padding:0;font-family:'Roboto',sans-serif;background:linear-gradient(135deg,#ff9a9e 0%,#fad0c4 50%,#a1c4fd 100%);overflow:hidden}
    .center-box{
      position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
      background:rgba(255,255,255,0.15);border-radius:30px;padding:48px 60px;text-align:center;
      box-shadow:0 8px 32px rgba(31,38,135,0.37);backdrop-filter:blur(8px);z-index:10;
    }
    h1{font-family:'Montserrat',sans-serif;font-size:3.2em;margin:0 0 16px;background:linear-gradient(90deg,#f7971e,#ffd200,#21d4fd,#b721ff,#fd1d1d);color:transparent;-webkit-background-clip:text;background-clip:text;letter-spacing:2px;animation:hue-rotate 6s infinite linear}
    @keyframes hue-rotate{0%{filter:hue-rotate(0deg)}100%{filter:hue-rotate(360deg)}}
    p{font-size:1.18em;color:#444;margin:0 0 30px}
    .btn{background:linear-gradient(90deg,#52e5e7,#130cb7);color:#fff;border:none;padding:12px 36px;font-size:1.05em;border-radius:30px;box-shadow:0 4px 16px rgba(0,0,0,0.12);cursor:pointer;transition:background .3s,transform .15s;font-family:'Montserrat',sans-serif;font-weight:700}
    .btn:hover{background:linear-gradient(90deg,#ff512f,#dd2476);transform:scale(1.06)}
    /* å…¨å±€ canvas å±‚ */
    canvas.background-waves, canvas#particles, canvas#geometry-bg{
      position:fixed;top:0;left:0;right:0;bottom:0;z-index:1;pointer-events:none;display:block;
    }
    canvas#geometry-bg{z-index:4}
    canvas#particles{z-index:3}
    canvas.background-waves{z-index:2}
    /* å¼¹å¹•æ ·å¼ */
    .danmu{
      position:fixed;left:100vw;white-space:nowrap;font-family:'Montserrat',sans-serif;font-weight:700;
      padding:6px 20px;border-radius:24px;background:linear-gradient(90deg,#ff0080,#7928ca,#42e695,#ffd200);background-size:300% 300%;
      color:#fff;box-shadow:0 2px 12px rgba(0,0,0,0.15);border:2px solid rgba(255,255,255,0.35);
      animation:danmu-move linear;z-index:100;pointer-events:none;user-select:none;
    }
    @keyframes danmu-move{from{left:100vw}to{left:-80vw}}
    .danmu .content{pointer-events:auto} /* å…è®¸å†…å®¹å†…é“¾æ¥ç‚¹å‡» */
    .danmu a{color:#fff;text-decoration:underline wavy #ffd200;font-weight:700}
    /* æ°”æ³¡æ ·å¼ */
    .bubble{position:fixed;bottom:-80px;border-radius:50%;opacity:0.85;pointer-events:none;z-index:2;mix-blend-mode:lighten;animation:bubble-rise linear}
    @keyframes bubble-rise{0%{transform:translateY(0) scale(1);opacity:0.9}80%{opacity:0.7}100%{transform:translateY(-100vh) scale(1.2);opacity:0}}
    /* èŠå¤©æ°”æ³¡ */
    .bubble-chat{
      position:fixed;min-width:140px;max-width:260px;padding:14px 20px;background:linear-gradient(135deg,#fff 60%,#f3d6ff 100%);
      border-radius:36px 36px 36px 12px;box-shadow:0 4px 24px rgba(100,0,150,0.14);color:#722ed1;font-size:1.05em;
      font-family:'Montserrat',sans-serif;left:70vw;bottom:18vh;z-index:99;border:2px solid #e1d4ff;display:none;
    }
    /* å°å±ä¼˜åŒ– */
    @media (max-width:520px){
      .center-box{padding:28px 18px;border-radius:18px}
      h1{font-size:2.0em}
      p{font-size:1em}
    }
  </style>
</head>
<body>
  <canvas class="background-waves"></canvas>
  <canvas id="particles"></canvas>
  <canvas id="geometry-bg"></canvas>

  <div class="center-box" role="main" aria-label="ç‚«é…·ç‰¹æ•ˆ">
    <h1>æ¬¢è¿ä½“éªŒç‰¹æ•ˆ</h1>
    <p>æ¼”ç¤ºï¼šæ°”æ³¡ Â· ç²’å­ Â· å¤šé¢ä½“ Â· å¼¹å¹•ï¼ˆæ”¯æŒ MathJaxï¼‰</p>
    <button class="btn" id="actionBtn">ç‚¹æˆ‘è¯•è¯•</button>
  </div>

  <div class="bubble-chat" id="bubble-chat">æ¬¢è¿æ¥åˆ°ç‚«é…·æ¼”ç¤ºï¼</div>

  <script>
    /* -------------------------
       èƒŒæ™¯æ³¢æµªï¼ˆcanvasï¼‰â€” è‡ªé€‚åº”
       ------------------------- */
    (function(){
      const canvas = document.querySelector('.background-waves');
      const ctx = canvas.getContext('2d');
      let w=0,h=0,t=0;
      function resize(){ w = canvas.width = innerWidth; h = canvas.height = innerHeight; }
      addEventListener('resize', resize, {passive:true});
      resize();
      function draw(){
        ctx.clearRect(0,0,w,h);
        for(let i=0;i<3;i++){
          ctx.beginPath();
          for(let x=0;x<=w;x+=10){
            const y = h/2 + Math.sin((x/200)+t + i*2)*60 + Math.cos((x/100)+t*1.5 + i*3)*40;
            if(x===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
          }
          ctx.lineWidth = 3 + i*2;
          ctx.strokeStyle = `hsla(${(t*50 + i*120)%360},90%,70%,0.15)`;
          ctx.stroke();
        }
        t += 0.012;
        requestAnimationFrame(draw);
      }
      draw();
    })();

    /* -------------------------
       å¼¹å¹•ï¼ˆdanmuï¼‰ â€” æ”¯æŒ MathJax ä¸ é“¾æ¥
       ------------------------- */
    (function(){
      // å®‰å…¨ç¤ºä¾‹å¼¹å¹•æ•°æ®ï¼Œæ”¯æŒ plain æ–‡æœ¬æˆ–å« LaTeX çš„å­—ç¬¦ä¸²
      const danmuList = [
        "\\text{âœ¨ æ¬¢è¿ âœ¨}",
        "è¿™æ˜¯æ™®é€šæ–‡æœ¬å¼¹å¹•",
        "\\(e^{i\\pi}+1=0\\)",
        "è®¿é—®ï¼š<a href=\"https://jishuge888.github.io/\" target=\"_blank\" rel=\"noopener\">æˆ‘çš„ç½‘ç«™</a>",
        "\\(\\int_0^{\\infty} e^{-x} dx = 1\\)"
      ];

      function safeCreateDanmu(content, opts = {}){
        const d = document.createElement('div');
        d.className = 'danmu';
        // é«˜åº¦èŒƒå›´ï¼šä¸Šæ–¹ 6% åˆ° 70% åŒºåŸŸï¼Œé¿å…è¦†ç›–åº•éƒ¨å¯¹è¯æ³¡
        const top = Math.random() * (innerHeight * 0.64) + (innerHeight * 0.06);
        d.style.top = `${top}px`;
        d.style.fontSize = `${(Math.random()*0.9 + 0.9)}em`;
        const duration = opts.duration || (9 + Math.random()*7); // åŠ¨ç”»æ—¶é•¿
        d.style.animationDuration = `${duration}s`;
        d.style.filter = `drop-shadow(0 2px 6px hsla(${Math.random()*360},80%,60%,0.3))`;
        // å†…å®¹å®¹å™¨ï¼šå…è®¸é“¾æ¥ç‚¹å‡»
        const contentWrap = document.createElement('span');
        contentWrap.className = 'content';
        // åˆ¤æ–­æ˜¯å¦åŒ…å« HTML é“¾æ¥æ ‡ç­¾ï¼Œè‹¥åŒ…å«åˆ™ä»¥ innerHTML æ’å…¥ï¼ˆä½†æ¥æºå—æ§ï¼‰
        if(/<a[\s\S]*?>[\s\S]*?<\/a>/.test(content)){
          contentWrap.innerHTML = content;
          // å…è®¸é“¾æ¥ç‚¹å‡»ï¼ˆå¦åˆ™ pointer-events: none ä¼šé˜»æ­¢ï¼‰
          d.style.pointerEvents = 'auto';
          contentWrap.style.pointerEvents = 'auto';
        } else {
          // æ™®é€šæˆ– LaTeX æ–‡æœ¬ï¼Œä½œä¸º textContent æ·»åŠ ï¼Œä¹‹åè¿è¡Œ MathJax æ¸²æŸ“
          contentWrap.textContent = content;
        }
        d.appendChild(contentWrap);
        document.body.appendChild(d);
        // å¦‚æœ MathJax å­˜åœ¨å¹¶ä¸”å¯èƒ½åŒ…å« TeXï¼Œå°±å°è¯• typeset
        if(window.MathJax && typeof window.MathJax.typesetPromise === 'function'){
          // å¦‚æœæ–‡æœ¬é‡Œæœ‰ TeX æ ‡è®°ï¼ˆ\( \) æˆ– \\[ \\] æˆ– $ $ï¼‰ï¼Œåˆ™è¿›è¡Œæ¸²æŸ“
          const ttxt = content;
          if(/\\\\\\(|\\\\\\)|\\$|\\(|\\)/.test(ttxt) || /\\\\\\[|\\\\\\]/.test(ttxt)){
            try{ MathJax.typesetPromise([contentWrap]).catch(()=>{}); }catch(e){}
          }
        }
        // è‡ªåŠ¨ç§»é™¤
        setTimeout(()=>{ if(d && d.parentNode) d.parentNode.removeChild(d); }, duration*1000 + 200);
      }

      // å®šæ—¶å‘å¼¹å¹•
      const interval = setInterval(()=>{
        const item = danmuList[Math.floor(Math.random()*danmuList.length)];
        safeCreateDanmu(item);
      }, 1900);

      // å¯¹å¤–æ¥å£ï¼šå¯é€šè¿‡ window.pushDanmu æ·»åŠ æ–°å¼¹å¹•
      window.pushDanmu = function(text){
        safeCreateDanmu(text, {duration: 10});
      };

      // æš´éœ²å½“å‰ listï¼ˆä¾¿äºè°ƒè¯•ï¼‰
      window._demoDanmuList = danmuList;
    })();

    /* -------------------------
       æ»šåŠ¨é“¾æ¥å¼¹å¹•ï¼ˆå•ç‹¬èŠ‚å¥ï¼‰
       ------------------------- */
    (function(){
      function createLinkDanmu(){
        const d = document.createElement('div');
        d.className = 'danmu';
        d.style.top = `${Math.random() * (innerHeight*0.60) + 10}px`;
        d.style.fontSize = `${(Math.random()*0.9 + 1.0)}em`;
        const duration = 9 + Math.random()*6;
        d.style.animationDuration = `${duration}s`;
        d.style.pointerEvents = 'auto';
        d.innerHTML = `<span class="content"><a href="https://jishuge888.github.io/" target="_blank" rel="noopener">ç‚¹å‡»è§‚çœ‹ç¤ºä¾‹é¡µé¢</a></span>`;
        document.body.appendChild(d);
        setTimeout(()=>{ if(d.parentNode) d.parentNode.removeChild(d); }, duration*1000 + 300);
      }
      setInterval(createLinkDanmu, 7000);
      setTimeout(createLinkDanmu, 1800);
    })();

    /* -------------------------
       æ°”æ³¡æ•ˆæœï¼ˆDOM å…ƒç´ ï¼‰
       ------------------------- */
    (function(){
      function createBubble(){
        const b = document.createElement('div');
        b.className = 'bubble';
        const size = Math.random()*46 + 16;
        b.style.width = b.style.height = `${size}px`;
        b.style.left = `${Math.random()*100}vw`;
        const hue = Math.floor(Math.random()*360);
        b.style.background = `radial-gradient(circle at 30% 35%, rgba(255,255,255,0.95), hsl(${hue} 70% 70%) 80%)`;
        b.style.opacity = (Math.random()*0.45 + 0.35).toFixed(2);
        const duration = (Math.random()*2 + 7.5).toFixed(2);
        b.style.animationDuration = `${duration}s`;
        document.body.appendChild(b);
        setTimeout(()=>{ if(b.parentNode) b.parentNode.removeChild(b); }, (parseFloat(duration)*1000) + 200);
      }
      setInterval(createBubble, 300);
    })();

    /* -------------------------
       ç²’å­ç³»ç»Ÿï¼ˆcanvasï¼‰â€” å¯é‡ç½®ã€å“åº”å°ºå¯¸
       ------------------------- */
    (function(){
      const pc = document.getElementById('particles');
      const ctx = pc.getContext('2d');
      let w = innerWidth, h = innerHeight;
      let particles = [];
      function resize(){
        w = pc.width = innerWidth; h = pc.height = innerHeight;
        particles = [];
        const count = Math.max(60, Math.floor((w*h)/12000));
        for(let i=0;i<count;i++){
          particles.push({
            x: Math.random()*w,
            y: Math.random()*h,
            r: Math.random()*2.6+0.8,
            d: Math.random()*Math.PI*2,
            c: `hsl(${Math.random()*360},80%,70%)`,
            s: Math.random()*1.2+0.4
          });
        }
      }
      addEventListener('resize', resize, {passive:true});
      resize();
      function update(){
        ctx.clearRect(0,0,w,h);
        for(let p of particles){
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
          ctx.fillStyle = p.c;
          ctx.globalAlpha = 0.78;
          ctx.shadowColor = p.c;
          ctx.shadowBlur = 8;
          ctx.fill();
          ctx.shadowBlur = 0;
          p.x += Math.sin(p.d) * p.s;
          p.y += Math.cos(p.d) * p.s;
          p.d += Math.random()*0.06 - 0.03;
          if(p.x < -10 || p.x > w + 10 || p.y < -10 || p.y > h + 10){
            p.x = Math.random()*w; p.y = Math.random()*h;
          }
        }
        ctx.globalAlpha = 1;
        requestAnimationFrame(update);
      }
      update();
    })();

    /* -------------------------
       å¤šé¢å‡ ä½•éª¨é“¾ï¼ˆcanvasï¼‰
       ------------------------- */
    (function(){
      const canvas = document.getElementById('geometry-bg');
      const gctx = canvas.getContext('2d');
      let gw = canvas.width = innerWidth;
      let gh = canvas.height = innerHeight;
      addEventListener('resize', ()=>{ gw = canvas.width = innerWidth; gh = canvas.height = innerHeight; }, {passive:true});

      function rotate3D([x,y,z], ax, ay, az){
        let radX = ax, radY = ay, radZ = az;
        let nx = x, ny = y*Math.cos(radX) - z*Math.sin(radX), nz = y*Math.sin(radX) + z*Math.cos(radX);
        let tx = nx*Math.cos(radY) + nz*Math.sin(radY), ty = ny, tz = -nx*Math.sin(radY) + nz*Math.cos(radY);
        let fx = tx*Math.cos(radZ) - ty*Math.sin(radZ), fy = tx*Math.sin(radZ) + ty*Math.cos(radZ), fz = tz;
        return [fx,fy,fz];
      }
      function project([x,y,z], cx, cy, scale=1.2){
        const d = 1000/(z+1800);
        return [ cx + (x*d*scale), cy + (y*d*scale) ];
      }

      const octahedron = {
        vertices:[[0,0,130],[0,0,-130],[130,0,0],[-130,0,0],[0,130,0],[0,-130,0]],
        edges:[[0,2],[0,3],[0,4],[0,5],[1,2],[1,3],[1,4],[1,5],[2,4],[2,5],[3,4],[3,5]]
      };
      const tetrahedron = {
        vertices:[[100,100,100],[-100,-100,100],[-100,100,-100],[100,-100,-100]],
        edges:[[0,1],[0,2],[0,3],[1,2],[1,3],[2,3]]
      };
      const cube = {
        vertices:[[-90,-90,-90],[90,-90,-90],[90,90,-90],[-90,90,-90],[-90,-90,90],[90,-90,90],[90,90,90],[-90,90,90]],
        edges:[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]]
      };

      function createBoneChain(n, radius, center, rot, offset=0){
        const arr=[];
        for(let i=0;i<n;i++){
          const a = i/n * Math.PI*2 + rot + offset;
          arr.push([ center[0] + Math.cos(a)*radius, center[1] + Math.sin(a)*radius ]);
        }
        return arr;
      }

      const polys = [
        { obj: octahedron, pos: ()=>[gw*0.24, gh*0.36], color: "#ffb347", rot:[0.1,0.3,0.1], dRot:[0.005,0.005,0.002], scale:1.1 },
        { obj: tetrahedron, pos: ()=>[gw*0.72, gh*0.62], color: "#7ee8fa", rot:[0.2,0.45,0.2], dRot:[0.004,0.004,0.003], scale:1.15 },
        { obj: cube, pos: ()=>[gw*0.52, gh*0.30], color: "#eec0c6", rot:[0.3,0.22,0.13], dRot:[0.006,0.003,0.005], scale:1.05 }
      ];

      function draw(){
        gctx.clearRect(0,0,gw,gh);
        for(let idx=0; idx<polys.length; idx++){
          const poly = polys[idx];
          for(let i=0;i<3;i++) poly.rot[i] += poly.dRot[i];
          const points = poly.obj.vertices.map(v=>rotate3D(v, ...poly.rot));
          const pos = poly.pos();
          const projs = points.map(v=>project(v, pos[0], pos[1], poly.scale));
          gctx.save();
          gctx.globalAlpha = 0.95;
          gctx.strokeStyle = poly.color;
          gctx.lineWidth = 3 + idx;
          for(const e of poly.obj.edges){
            gctx.beginPath();
            gctx.moveTo(projs[e[0]][0], projs[e[0]][1]);
            gctx.lineTo(projs[e[1]][0], projs[e[1]][1]);
            gctx.stroke();
          }
          // é¡¶ç‚¹å‘å…‰ç‚¹
          gctx.globalAlpha = 1;
          for(const p of projs){
            gctx.beginPath();
            gctx.arc(p[0], p[1], 6 + idx*1.4, 0, Math.PI*2);
            gctx.fillStyle = "#fff";
            gctx.shadowColor = poly.color;
            gctx.shadowBlur = 16;
            gctx.fill();
            gctx.shadowBlur = 0;
          }
          gctx.restore();

          // ç»˜åˆ¶éª¨é“¾
          const nChain = 10 + idx*3;
          const chainRad = 160 + idx*50;
          const chain = createBoneChain(nChain, chainRad, pos, poly.rot[2]);
          gctx.save();
          gctx.strokeStyle = "rgba(0,0,0,0.12)";
          gctx.lineWidth = 1.6;
          for(let j=0;j<chain.length;j++){
            const p1 = chain[j], p2 = chain[(j+1)%chain.length];
            gctx.beginPath();
            gctx.moveTo(p1[0], p1[1]);
            gctx.lineTo(p2[0], p2[1]);
            gctx.stroke();
            gctx.beginPath();
            gctx.arc(p1[0], p1[1], 5 + idx*1.2, 0, Math.PI*2);
            gctx.fillStyle = "rgba(255,255,255,0.55)";
            gctx.shadowColor = poly.color;
            gctx.shadowBlur = 8;
            gctx.fill();
            gctx.shadowBlur = 0;
          }
          // ä¸­å¿ƒåˆ°éª¨é“¾è¿çº¿
          for(let j=0;j<chain.length;j+=Math.floor(Math.max(1,chain.length/3))){
            gctx.beginPath();
            gctx.moveTo(pos[0], pos[1]);
            gctx.lineTo(chain[j][0], chain[j][1]);
            gctx.strokeStyle = poly.color + "88";
            gctx.lineWidth = 2.2;
            gctx.stroke();
          }
          gctx.restore();
        }
        requestAnimationFrame(draw);
      }
      draw();
    })();

    /* -------------------------
       èŠå¤©æ°”æ³¡ä¸æŒ‰é’®äº¤äº’
       ------------------------- */
    (function(){
      const bubbleChat = document.getElementById('bubble-chat');
      setTimeout(()=>{
        bubbleChat.style.display = 'block';
        bubbleChat.textContent = 'ğŸ‰ æ¬¢è¿æ¥åˆ°ç‰¹æ•ˆæ¼”ç¤ºé¡µé¢ï¼';
        setTimeout(()=>bubbleChat.style.display='none', 3500);
      }, 1600);

      document.getElementById('actionBtn').addEventListener('click', ()=>{
        // è§¦å‘ä¸€ä¸ª MathJax å¼¹å¹•ä¸æ™®é€šæç¤º
        if(window.pushDanmu) window.pushDanmu("\\(\\sum_{n=1}^{\\infty} \\frac{1}{n^2} = \\frac{\\pi^2}{6}\\)");
        bubbleChat.textContent = 'ç‚¹æˆ‘è§¦å‘äº†å¼¹å¹• âœ¨';
        bubbleChat.style.display = 'block';
        setTimeout(()=>bubbleChat.style.display='none', 2400);
      }, {passive:true});
    })();

    /* -------------------------
       MathJax åŠ è½½ï¼ˆç”¨äºæ¸²æŸ“å¼¹å¹•ä¸­çš„ LaTeXï¼‰
       ------------------------- */
    window.MathJax = {
      tex: { inlineMath: [['\\(', '\\)'], ['$', '$'], ['\\\\[','\\\\]']] },
      svg: { fontCache: 'global' }
    };
    (function(){
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js';
      script.async = true;
      document.head.appendChild(script);
    })();

    /* è¯´æ˜ï¼ˆæ³¨é‡Šï¼‰ï¼š
       - è‹¥éœ€è¦åœ¨å…¶å®ƒé¡µé¢æˆ–åŠ¨æ€æ·»åŠ å…ƒç´ ä¸Šä¹Ÿä½¿ç”¨è¿™äº›ç‰¹æ•ˆï¼Œåªéœ€ç¡®ä¿é¡µé¢åŒ…å«ç›¸åŒçš„ canvas å…ƒç´ å’Œç›¸å…³è„šæœ¬ï¼Œæˆ–ç›´æ¥å¤ç”¨ window.pushDanmu(text) æ¥å‘å¼¹å¹•ã€‚
       - ä¸ºé¿å…é¡µé¢æ€§èƒ½é—®é¢˜ï¼Œå¤§é‡å¼¹å¹•/æ°”æ³¡ä¼šæ¶ˆè€— CPU/GPUï¼Œè¯·æ ¹æ®éœ€è¦è°ƒæ•´ setInterval çš„é—´éš”æˆ–ç²’å­æ•°é‡ã€‚
    */
  </script>
</body>
</html>